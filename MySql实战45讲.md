# 1. 基础架构：sql查询语句如何执行

![img](D:\WorkData\MarkdownData\assets\0d2070e8f84c4801adbfa03bda1f98d9.png)

**MySQL可以分为Server层和存储引擎层两部分。**

##  Server层

Server层包括连接器、查询缓存、分析器、优化器、执行器等

### 连接器

连接器负责跟客户端建立连接、获取权限、维持和管理连接

### 查询缓存

MySQL拿到一个查询请求后，会先到查询缓存看看，之前是不是执行过这条语句，但不建议使用查询缓存

query_cache_type设置成DEMAND，这样对于默认的SQL语句都不使用查询缓存

### 分析器

分析器先会做“词法分析”,判断你输入的字符代表SQL语句中的什么

再做“语法分析”，判断你输入的语句是否满足MYSQL的语法

### 优化器

优化器是在表里面有多个索引的时候，决定使用哪个索引

### 执行器

如果有权限，就打开表继续执行。打开表的时候，执行器就会根据表的引擎定义，去使用这个引擎提供的接口。



##  存储引擎层

存储引擎层负责数据的存储和提取，不同的存储引擎共用一个**Server层**

# 2. 日志系统：sql更新语句如何执行

## 日志模块： redo log

InnoDB引擎就会先把记录写到redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。

## 日志模块： binlog

## 日志的区别：

1. redo log是InnoDB引擎特有的；binlog是MySQL的Server层实现的，所有引擎都可以使用。
2. redo log是物理日志，记录的是“在某个数据页上做了什么修改”；binlog是逻辑日志，记录的是这个语句的原始逻辑，比如“给ID=2这一行的c字段加1 ”。
3. redo log是循环写的，空间固定会用完；binlog是可以追加写入的。“追加写”是指binlog文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。



# 3. 事务隔离

事务就是要保证一组数据库操作，要么全部成功，要么全部失败

## 1. 事务的特性

ACID（Atomicity、Consistency、Isolation、Durability，即原子性、一致性、隔离性、持久性）

## 2.多事务执行可能出现的问题

脏读、不可重复读、幻读

## 3. 事务隔离的级别

读未提交、读提交、可重复读、串行化

## 4. 事务隔离级别的区别

读未提交：一个事务还未提交，它所做的变更就可以被别的事务看到
读提交：一个事务提交之后，它所做的变更才可以被别的事务看到
可重复读：一个事务执行过程中看到的数据是一致的。未提交的更改对其他事务是不可见的
串行化：对应一个记录会加读写锁，出现冲突的时候，后访问的事务必须等前一个事务执行完成才能继续执行
